

## STP

○ 스위치(브리지) 5가지 기능(스위치가 하는 5가지일) <br/>
① Learning: 배운다. (맥 어드레스를 외운 다음 테이블에 저장한다.)<br/>
② Flooding: 모르면 들어온 포트를 제외한 다른 모든 포트로 뿌린다.<br/>
③ Forwarding: 해당 포트로 전달한다.<br/>
④ Filtering: 다른 포트로는 못 건너가게 막는다.<br/>
⑤ Aging: 나이를 먹는다. (Mac Address Table을 주기적으로 갱신한다.)<br/>

원인: Flooding → 해결책 : STP(Spanning Tree Protocol)<br/>
- 두 개 이상의 경로가 생기면 루핑 현상을 예방하기 위해 한 개의 경로만 제외, 나머지 경로들은 자동차단<br/>
- 기존 경로에 문제가 생기면 막아 놓은 경로를 풀어서 데이터를 전송<br/>
- IEEE 802.1D<br/>


storm control 설정은 실제 장비에서 브로드캐스트가 전체 사용 가능량의 일정 비율(아래는 45%)을 넘으면 포트를 자동으로 다운 시킨다.<br/>
가상환경(packet tracer, gns)에서는 동작되지 않지만, 실무에서 많이 사용되는 보안 설정이다.<br/>
access-port에 주로 적용하는 보안 설정 중에 하나이다. (storm-control + BPDU Guard + PortFast)<br/>
→ storm-control broadcast level 45<br/>
<br/>
Switch(config)#int f0/3<br/>
Switch(config-if)#storm-control broadcast level 45<br/>
Switch(config-if)#storm-control action shutdown   ← 패킷트레이서에서 적용 불가<br/>


<img width="745" height="294" alt="image" src="https://github.com/user-attachments/assets/ff915190-2a5e-4e01-a9e3-3ffd531428c0" />


<img width="774" height="285" alt="image" src="https://github.com/user-attachments/assets/556b30bb-7e86-4f44-9c20-6558d124ca1d" />


<img width="639" height="276" alt="image" src="https://github.com/user-attachments/assets/6c97d9b8-5c7a-4e8f-b144-26ddbca99cb6" />


내 스위치에서 포트의 역할 변경<br/>
<br/>
특정 인터페이스 cost 변경 : 4 → 10 으로 수정<br/>
SW6(config)#int g0/3<br/>
SW6(config-if)#spanning-tree vlan 1 cost 10<br/>


SW6(config-if)#no spanning-tree vlan 1 cost 10<br/>
<br/>

상대 스위치에서 포트의 역할 변경<br/>
<br/>
특정 인터페이스 port priority 변경 : 128.4 → 16.4 로 수정<br/>
<br/>
SW5(config)#INT G0/3<br/>
SW5(config-if)#spanning-tree vlan 1 ?<br/>
SW5(config-if)#spanning-tree vlan 1 port-priority 16<br/>


SW5(config-if)#no spanning-tree vlan 1 port-priority 16<br/>




<img width="902" height="412" alt="image" src="https://github.com/user-attachments/assets/fb90b696-af60-415b-8bb3-961bd3e1187a" />


<img width="591" height="225" alt="image" src="https://github.com/user-attachments/assets/a73c05bd-9ced-446b-a517-0348c2a77444" />


uplinkfast : 차단 포트가 있는 access switch에 설정 한다.<br/>


SW3(config)#spanning-tree uplinkfast<br/>

uplinkfast 설정 후 매우 짧은 전환시간이 소요된다.<br/>
SW3(config)#int g0/1<br/>
SW3(config-if)#sh<br/>
*Dec 16 02:52:36.233: STP: VLAN0001 new root port Gi0/3, cost 3008<br/>
*Dec 16 02:52:36.233: %SPANTREE_FAST-7-PORT_FWD_UPLINK: VLAN0001 GigabitEthernet0/3 moved to Forwarding (UplinkFast).<br/>

<img width="623" height="376" alt="image" src="https://github.com/user-attachments/assets/e9ed7e8e-670a-42e5-a7b2-a421d5e7fc4b" />

SW3#
*Dec 16 03:01:58.551: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:00.070: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:02.070: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:04.071: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:06.072: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:08.073: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:10.074: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:12.075: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:14.076: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
SW3#<br/>
*Dec 16 03:02:16.077: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
*Dec 16 03:02:16.551: STP: VLAN0001 Gi0/3 -> listening<br/>
SW3#<br/>
*Dec 16 03:02:17.564: STP: VLAN0001 Topology Change rcvd on Gi0/3<br/>
*Dec 16 03:02:17.565: STP: VLAN0001 sent Topology Change Notice on Gi0/1<br/>
SW3#<br/>
*Dec 16 03:02:31.551: STP: VLAN0001 Gi0/3 -> learning<br/>
SW3#<br/>
*Dec 16 03:02:46.551: STP[1]: Generating TC trap for port GigabitEthernet0/3<br/>
*Dec 16 03:02:46.552: STP: VLAN0001 sent Topology Change Notice on Gi0/1<br/>
*Dec 16 03:02:46.552: STP: VLAN0001 Gi0/3 -> forwarding<br/>
<br/>
root 전환까지 20초 정도 <br/>

모든 스위치에서 적용<br/>
spanning-tree backbonefast<br/>
<br/>
sw2으로 부터 후순위 bpdu 를 수신 후 바로 listening 으로 전환 시작<br/>
<br/>
SW3#<br/>
*Dec 16 03:07:09.549: STP: VLAN0001 heard root 32769-2022.2222.2222 on Gi0/3<br/>
*Dec 16 03:07:09.552: STP: VLAN0001 Gi0/3 -> listening<br/>
*Dec 16 03:07:09.776: STP: VLAN0001 Topology Change rcvd on Gi0/3<br/>
*Dec 16 03:07:09.778: STP: VLAN0001 sent Topology Change Notice on Gi0/1<br/>




















































































































































































