
## 게이트웨이 이중화 



### Standby

<img width="1038" height="411" alt="image" src="https://github.com/user-attachments/assets/31ab3cf8-6843-4f45-a2c5-6bbaa38de301" />

#### R1~R2

conf t<br/>
int f0/0<br/>
standby 1 ip 10.1.1.254<br/>

R1(config-if)#do sh standby br<br/>
                     P indicates configured to preempt.<br/>
                     |<br/>
Interface   Grp  Pri P State   Active          Standby         Virtual IP<br/>
Gi0/0       1    100   **Active**  local           10.1.1.252      10.1.1.254<br/>

R2(config-if)#standby 1 ip 10.1.1.254<br/>
R2(config-if)#do sh standby br<br/>
                     P indicates configured to preempt.<br/>
                     |<br/>
Interface   Grp  Pri P State   Active          Standby         Virtual IP<br/>
Gi0/0       1    100   **Standby** 10.1.1.253      local           10.1.1.254<br/>

pc에서 ping 10.1.1.254 한 뒤에 sh arp를 하면 Virtual MAC 주소도 확인할 수 있다.

<img width="1297" height="416" alt="image" src="https://github.com/user-attachments/assets/069f79fd-24d8-4a7d-bb23-364dcfabbbef" />

#### NAT 추가


#### R1

standby 1 priority 105(숫자가 크면 우선순위가 더 높음)<br/>
do sh standby br<br/>

standby 1 preempt (선점 기능 활성화)

#### R2

standby 1 priority 110<br/>
standby 1 preempt<br/>

R2가 Active 라우터로 변경<br/>

#### R1~R2

int f0/0<br/>
no standby 1<br/>


### VRRP(Virtual Router Redundancy Protocol)

- 게이트웨이 이중화 프로토콜(3계층)이다.
- 단일 게이트웨이로 운영될 경우 장애가 서비스 단절까지 유발시키는것에 대한 장애 방지 및 패킷 전송의 연송석을 보장하는 역할을 한다.
- 게이트웨이의 Active/Standby 및 Active/Active 설정을 할 수 있다.
- Active 게이트웨이의 장애 발생에 따른 자동 전환을 지원한다.

#### R1~R2

vrrp 1 ip 10.1.1.254<br/>
do sh vrrp br<br/>

R1(config-if)#do sh vrrp br<br/>
Interface          Grp Pri Time  Own Pre State   Master addr     Group addr<br/>
Fa0/0              1   100 3609       Y  **Master**  10.1.1.253      10.1.1.254<br/>
<br/>
R2(config-if)#do sh vrrp br<br/>
Interface          Grp Pri Time  Own Pre State   Master addr     Group addr<br/>
Fa0/0              1   100 3609       Y  **Backup**  10.1.1.253      10.1.1.254<br/>

* VRRP는 standby와 다르게 처음부터 preempt가 enable<br/>

### VRRP Tracking 설정

Gateway 역할을 수행하는 라우터의 상위 구간(Uplink)에 장애가 발생하면,<br/> 
해당 라우터는 여전히 VRRP Master로 동작하지만 실제 패킷은 <br/>
외부로 나가지 못하는 Blackhole 현상이 발생합니다.<br/>

R1(config)#track 100 interface g1/0 line-protocol<br/>
R1(config-if)#vrrp 1 track 100 decrement 20<br/>

R2(config)#track 100 interface g1/0 line-protocol<br/>
R2(config-if)#vrrp 1 track 100 decrement 20<br/>

#### vrrp 취소

no vrrp 1

### HSRP(Got Standby Router Protocol)

- 게이트웨이 이중화 프로토콜(3계층)로 액티브 라우터 장애 시 패킷 전송의 연속성을 보장하는 역할을 한다.
- 게이트웨이의 Active/Standby 및 Active/Active 설정을 할 수 있다.
- 액티브 게이트웨이의 장애 발생에 따른 자동 전환을 지원한다.

**AVG (Active Virtual Gateway)의 역할**
- 그룹당 하나의 AVG(Active Virtual Gateway) 선출된다.
- 가상 MAC 주소 할당: AVG는 GLBP 그룹 내의 다른 라우터들(AVF)에게 가상 MAC 주소를 할당한다.
- ARP 요청 처리: 클라이언트로부터 게이트웨이 IP 주소에 대한 ARP 요청을 받으면, AVG가 이를 처리한다.
- 로드 밸런싱 관리: AVG는 ARP 응답을 통해 AVF들의 가상 MAC 주소를 분배하여 로드 밸런싱을 구현한다.

**AVF (Active Virtual Forwarder)의 역할**<br/>

  - 트래픽 전달: AVF는 실제로 클라이언트의 트래픽을 전송하는 역할을 수행한다
  - 가상 MAC 주소 사용: 각 AVF는 AVG로부터 할당받은 고유한 가상 MAC 주소를 사용한다
  - 부하 분산: 여러 AVF가 동시에 활성화되어 네트워크 트래픽의 부하를 분산한다
  - 이중화 제공: 한 AVF에 장애가 발생하면 다른 AVF가 해당 트래픽을 넘겨받아 전송을 수행한다

R1(config-if)#do sh run int g0/0<br/>
 glbp 1 ip 10.1.1.254<br/>
 glbp 1 preempt<br/>

R2(config-if)#do sh run int g0/0<br/>
 glbp 1 ip 10.1.1.254<br/>
 glbp 1 priority 105<br/>
 glbp 1 preempt<br/>

R2(config-if)#do sh glbp br<br/>
Interface   Grp  Fwd Pri State    Address         Active router   Standby router<br/>
Gi0/0       1    -   105 Active   10.1.1.254      local           10.1.1.253<br/>
Gi0/0       1    1   -   Listen   0007.b400.0101  10.1.1.253      -<br/>
Gi0/0       1    2   -   Active   0007.b400.0102  local           -<br/>
R2(config-if)#do sh run int g0/0<br/>

PC1> sh arp

**00:07:b4:00:01:02**  10.1.1.254 expires in 111 seconds 

PC2> sh arp

**00:07:b4:00:01:01**  10.1.1.254 expires in 114 seconds 



















































































































































































































